<ion-button (click)="goBack()" class="back-button-floating-new">
  <ion-icon slot="icon-only" name="arrow-back-outline"></ion-icon>
</ion-button>

<ion-content [fullscreen]="true">
  <div class="header-container">
    <div class="header-content">

      <div *ngIf="!verificationComplete">
        <h2 class="page-title ion-text-center ion-padding-bottom">Código de Verificación</h2> <p class="ion-text-center ion-padding-bottom instruction-text">Ingresa el código que enviamos a <strong>{{ email }}</strong>.</p>

        <form [formGroup]="codeForm" (ngSubmit)="verifyCode()">

          <ion-item fill="outline" class="ion-margin-bottom input-item"> <input
              type="tel"
              formControlName="codigo"
              maxlength="6"
              placeholder="Código de 6 dígitos"
              inputmode="numeric"
              class="native-input"/>
          </ion-item>
          <div *ngIf="c['codigo'].touched && c['codigo'].errors" class="error-message">
            <p *ngIf="c['codigo'].errors['required']">El código es obligatorio.</p>
            <p *ngIf="c['codigo'].errors['minlength'] || c['codigo'].errors['maxlength']">Debe ser de 6 dígitos.</p>
          </div>

          <ion-button
            type="submit"
            expand="block"
            [disabled]="codeForm.invalid"
            class="ion-margin-top submit-button">
            Verificar Código
          </ion-button>
        </form>
      </div>

      <div *ngIf="verificationComplete">
        <h2 class="page-title ion-text-center ion-padding-bottom">Define tu Nueva Contraseña</h2> <p class="ion-text-center ion-padding-bottom instruction-text">Verificación exitosa. Ingresa tu nueva contraseña.</p>

        <form [formGroup]="resetForm" (ngSubmit)="onSubmit()">

          <ion-item fill="outline" class="ion-margin-bottom input-item"> <input
              [type]="showPassword ? 'text' : 'password'"
              formControlName="password"
              placeholder="Nueva Contraseña"
              class="native-input"/>
            <ion-icon slot="end"
                      [name]="showPassword ? 'eye-off-outline' : 'eye-outline'"
                      (click)="togglePasswordVisibility()"
                      aria-label="Mostrar contraseña"></ion-icon>
          </ion-item>
          <div *ngIf="f['password'].touched && f['password'].errors" class="error-message">
            <p *ngIf="f['password'].errors['required']">La contraseña es obligatoria.</p>
            <p *ngIf="f['password'].errors['minlength']">Mínimo 6 caracteres.</p>
          </div>

          <ion-item fill="outline" class="ion-margin-bottom input-item"> <input
              [type]="showConfirmPassword ? 'text' : 'password'"
              formControlName="confirmPassword"
              placeholder="Confirmar Contraseña"
              class="native-input"/>
            <ion-icon slot="end"
                      [name]="showConfirmPassword ? 'eye-off-outline' : 'eye-outline'"
                      (click)="toggleConfirmPasswordVisibility()"
                      aria-label="Mostrar confirmación"></ion-icon>
          </ion-item>
          <div *ngIf="f['confirmPassword'].touched && f['confirmPassword'].errors" class="error-message">
            <p *ngIf="f['confirmPassword'].errors['required']">La confirmación es obligatoria.</p>
          </div>
          <div *ngIf="resetForm.errors?.['passwordsMismatch'] && f['confirmPassword'].touched" class="error-message">
            <p>Las contraseñas no coinciden.</p>
          </div>

          <ion-button
            type="submit"
            expand="block"
            [disabled]="resetForm.invalid"
            class="ion-margin-top submit-button">
            Guardar Contraseña
          </ion-button>
        </form>
      </div>
    </div>
  </div>
</ion-content>